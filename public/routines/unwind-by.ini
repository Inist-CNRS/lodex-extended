mimeType = application/json
label = unwind

[use]
plugin = basics
plugin = lodex

[buildContext]
connectionStringURI = get('connectionStringURI')

[LodexAggregateQuery]
stage = fix(`$project: { value: { $arrayElemAt: [ "$versions.${env('field.0')}", -1 ] } }`)
stage = $unwind: "$value"
stage = $group: {_id: "$_id",value: { $addToSet: "$value" } }

[exchange]
value = get('value')

[LodexOutput]
keyName = items
indent = true
extract = total
